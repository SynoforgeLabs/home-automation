#!/bin/bash

# ESP32 Serial Monitor Script
# Usage: ./serial-monitor

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}ESP32 Serial Monitor${NC}"
echo "=========================="

# Find CP2102 device (common ESP32 USB-to-serial chip)
PORT=$(ls -1 /dev/serial/by-id/*CP2102* 2>/dev/null | head -n1)

if [ -z "$PORT" ]; then
    # Fallback to check common USB serial ports
    echo -e "${YELLOW}CP2102 device not found, checking common USB ports...${NC}"
    
    for port in /dev/ttyUSB0 /dev/ttyUSB1 /dev/ttyACM0 /dev/ttyACM1; do
        if [ -e "$port" ]; then
            PORT="$port"
            break
        fi
    done
fi

if [ -z "$PORT" ]; then
    echo -e "${RED}Error: No ESP32 device found!${NC}"
    echo "Available serial devices:"
    ls -la /dev/tty* | grep -E "(USB|ACM)" || echo "None found"
    echo ""
    echo "Make sure your ESP32 is connected via USB."
    exit 1
fi

echo -e "${GREEN}Found ESP32 at: $PORT${NC}"
echo -e "${YELLOW}Press Ctrl+A then Ctrl+X to exit picocom${NC}"
echo "Starting serial monitor..."
echo ""

# Start picocom with 115200 baud rate
picocom -b 115200 "$PORT"
